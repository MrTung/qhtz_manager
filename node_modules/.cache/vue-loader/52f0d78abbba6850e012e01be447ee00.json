{"remainingRequest":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/src/views/mission/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/src/views/mission/index.vue","mtime":1567846802514},{"path":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/dongxuwei/Desktop/系统相关/代码/advance-platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Qs from \"qs\";\nimport { getTimeDate } from \"@/utils/index.js\";\nimport TaskInfo from \"./taskinfo\";\n\nexport default {\n  components: { TaskInfo },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        草稿: \"info\",\n        待审核: \"gray\",\n        审核中: \"primary\",\n        发布成功: \"success\",\n        任务完成: \"danger\"\n      };\n      return statusMap[status];\n    }\n  },\n  computed: {\n    getbalance() {\n      let userinfo = this.$store.state.userinfo;\n      return userinfo.balance;\n    }\n  },\n  data() {\n    return {\n      currentPage: 1,\n      pageSize: 5,\n      total: 0,\n\n      selectTaskData: {},\n\n      dialogTableVisible: false,\n      statusList: [],\n      list: null,\n      listLoading: true,\n      form: {\n        shopid: \"\",\n        taskStatusId: \"\",\n        starttime: \"\",\n        endtime: \"\",\n        _uiName_: \"eleme\"\n      }\n    };\n  },\n  created() {\n    this.fetchData();\n\n    this.getStatusList();\n  },\n  methods: {\n    handleClose(done) {\n      this.$confirm(\"确认关闭？\")\n        .then(_ => {\n          done();\n        })\n        .catch(_ => {});\n    },\n    //获取任务状态列表\n    getStatusList() {\n      this.axios.get(this.urls.statuslist).then(response => {\n        this.statusList = response.data;\n      });\n    },\n    //获取店铺列表\n\n    formatTime(row, column, cellValue) {\n      return getTimeDate(cellValue);\n    },\n\n    onCancel() {\n      this.form.shopid = \"\";\n      this.form.taskStatusId = \"\";\n      this.form.starttime = \"\";\n      this.form.endtime = \"\";\n    },\n    fetchData() {\n      let page = { pageNumber: this.currentPage, pageSize: this.pageSize };\n\n      this.form[\"_pagination\"] = JSON.stringify(page);\n      this.listLoading = true;\n      //获取任务列表\n      this.axios\n        .get(this.urls.getMissionList + \"?\" + Qs.stringify(this.form))\n        .then(response => {\n          this.list = response.data.list;\n          this.total = response.data.totalRow;\n\n          this.listLoading = false;\n        });\n    },\n\n    //发布任务\n    publish(index, row) {\n      let g = 0;\n      if (row.payMent == \"商家远程代付\") {\n        g = 0;\n      } else {\n        g = row.unitPrice * row.buyNum * row.missionQuantity;\n      }\n\n      let s = row.salary * row.missionQuantity;\n\n      if (this.getbalance < g + s)\n        return this.$message.error(\n          \"您的账户余额不足以发布本次任务,请充值后再试\"\n        );\n\n      const h = this.$createElement;\n\n      let t = g + s;\n      this.$msgbox({\n        title: \"提示\",\n        message: h(\"p\", null, [\n          h(\"span\", null, \"本次任务将从您的账户扣除 \"),\n          h(\n            \"span\",\n            { style: \"color: red;font-size:19px;font-weight:bold\" },\n            \"￥\" + t\n          ),\n          h(\"span\", null, \",是否发布?\")\n        ]),\n        showCancelButton: true,\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        beforeClose: (action, instance, done) => {\n          if (action === \"confirm\") {\n            let param = {\n              id: row.id\n            };\n            this.axios\n              .post(this.urls.changgeMissionstatus + \"?\" + Qs.stringify(param))\n              .then(response => {\n                this.fetchData();\n                this.$message({\n                  message: \"发布成功!\",\n                  type: \"success\"\n                });\n              });\n            done();\n          } else {\n            done();\n          }\n        }\n      }).then(action => {});\n    },\n    handleEdit(index, row) {\n      this.$router.push({\n        name: \"newtask\",\n        params: {\n          form: row\n        }\n      });\n    },\n    operationHandle(index, row) {\n      this.dialogTableVisible = true;\n      this.selectTaskData = row;\n    },\n    editDialogListener(bol) {\n      this.dialogTableVisible = bol;\n    },\n\n    //修改任务状态\n    editMisson() {\n      // let param = {\n      //   businessId: this.$store.state.userinfo.id,\n      //   shopName: this.form.shopName,\n      //   shopAccount: this.form.shopAccount,\n      //   shopType: this.form.shopType,\n      //   businessId: this.$store.state.userinfo.id,\n      //   shopUrl: this.form.shopUrl\n      // };\n      // this.axios\n      //   .post(this.urls.changgeMissionstatus + \"?\" + Qs.stringify(param))\n      //   .then(response => {\n      //     this.fetchData();\n      //   });\n    },\n\n    handleSizeChange(val) {\n      this.pageSize = val;\n      this.fetchData();\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.fetchData();\n    }\n  }\n};\n",null]}